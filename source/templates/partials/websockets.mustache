<script>

	var wsn;
	var wsc;
	var dataPrevious = 0;
	
	// handle page updates from one browser to another
	function connectNavSync() {

		wsn = new WebSocket("ws://{{ websocketaddress }}:{{ navsyncport }}/navsync");
		wsn.onmessage = function (event) {
			
			if ($sgViewport.attr('src') != event.data) {
				$sgViewport.attr('src',event.data+'?'+dataPrevious);
			}
			
		}
	}
	connectNavSync();
	
	// handle content updates generated by the watch
	function connectContentSync() {
		var dc = true;
		wsc = new WebSocket("ws://{{ websocketaddress }}:{{ contentsyncport }}/contentsync");
		wsc.onmessage = function (event) {
			
			if (dc !== false) {
				if (event.data != dataPrevious) {
					$sgViewport.attr('src',$sgViewport.attr('src')+'?'+event.data);
					dataPrevious = event.data;
				}
			} else {
				dc = true;
				dataPrevious = event.data;
			}
			
		}
	}
	connectContentSync();
	
	$('#navSyncButton').click(function() {
		if ($(this).attr("data-state") == "on") {
			wsn.close();
			$(this).attr("data-state","off");
			$(this).removeClass("connected");
			$(this).html('Nav Sync Off');
		} else {
			connectNavSync();
			$(this).attr("data-state","on");
			$(this).addClass("connected");
			$(this).html('Nav Sync On');
		}
	});
	
	$('#contentSyncButton').click(function() {
		if ($(this).attr("data-state") == "on") {
			wsc.close();
			$(this).attr("data-state","off");
			$(this).removeClass("connected");
			$(this).html('Content Sync Off');
		} else {
			connectContentSync();
			$(this).attr("data-state","on");
			$(this).addClass("connected");
			$(this).html('Content Sync On');
		}
	});
	
</script>